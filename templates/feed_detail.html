{% extends "base.html" %}
{% block content %}
<main class="container">
  <p><a href="/feeds">&larr; Back to feeds</a></p>
  <header>
    <h1>{{ feed['title'] or feed['url'] }}</h1>
    <p>{{ feed['description'] or '' }}</p>
  </header>

  <section style="margin-top: 1.5rem;">
    {% for ep in episodes %}
      <article>
        <header>
          <h3>{{ ep['title'] or 'Untitled episode' }}</h3>
          <p><small>{{ ep['published_at'] or '' }}</small></p>
        </header>
        <p>{{ ep['description']|default('')|safe }}</p>
        {% set ep_conversions = conversions.get(ep['id'], {}) %}
        <div class="convert-grid">
          {% for speed in speeds %}
            {% set existing = ep_conversions.get(speed.label) %}
            <div class="convert-option">
              {% if existing %}
                <a class="contrast" href="{{ existing }}" download>{{ speed.label }}x</a>
              {% else %}
                <button
                  hx-post="/episodes/{{ ep['id'] }}/convert"
                  hx-vals='{"speed": "{{ speed.value }}"}'
                  hx-target="closest .convert-option"
                  hx-swap="innerHTML"
                  hx-indicator="closest .convert-option .spinner">
                  {{ speed.label }}x
                </button>
                <span class="spinner htmx-indicator" aria-hidden="true"></span>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </article>
    {% else %}
      <p>No episodes yet for this feed.</p>
    {% endfor %}
  </section>
</main>
{% endblock %}
